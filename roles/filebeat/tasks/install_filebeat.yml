- name: Copy Filebeat Installation Package
  include_tasks: copy_filebeat_package.yml
  when: airgap_environment == "enabled"

 
- name: Install Filebeat Service
  shell: rpm -vi "{{ filebeat_rpm_destination_path }}"
  when:
    - ansible_facts['distribution'] == 'RedHat'
    - airgap_environment = "enabled"


- name: Install Filebeat Service (RedHat)
  block:
    - name: Import Elasticsearch GPG key
      shell: rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch
      when: airgap_environment == "disabled"

    - name: Copy elastic.repo file
      template:
        src: /ansible_playbook_filebeat/roles/filebeat/templates/elastic.repo.j2
        dest: /etc/yum.repos.d/elastic.repo
        owner: root
        group: root
        mode: '0644'
      when: airgap_environment == "disabled"

    - name: Install Filebeat Package
      shell: yum install filebeat -y
      when: ansible_facts['distribution'] == 'RedHat' and airgap_environment == "disabled"

    - name: Enable Filebeat Service
      shell: systemctl enable filebeat
      when: ansible_facts['distribution'] == 'RedHat' and airgap_environment == "disabled"

- name: Install Filebeat Service
  shell: dpkg -i "{{ filebeat_deb_destination_path }}"
  when:
    - ansible_facts['distribution'] == 'Debian' or ansible_facts['distribution'] == 'Ubuntu'
    - airgap_environment == "enabled"


- name: Install Filebeat Service
  shell: |
    apt update
    wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
    apt-get install apt-transport-https
    echo "deb https://artifacts.elastic.co/packages/8.x/apt stable main" | sudo tee -a /etc/apt/sources.list.d/elastic-8.x.list
    apt-get update && apt-get install filebeat
  when: 
    - ansible_facts['distribution'] == 'Debian' or ansible_facts['distribution'] == 'Ubuntu'
    - airgap_environment == "disabled"






